<%-include("../partials/head")%>
<%-include("../partials/header")%>
<div class="container content" id="bodySub">
    <h2>{{namePage}}</h2>
   <subgenre-book :list-book="listBook" :handler-buy="handlerBuy"></subgenre-book>
</div>
<script>
    const bodySub = Vue.createApp({
        data(){
            return{
                idSubgenre:0,
                namePage:"",
                listBook:[]
            }
        },
        methods:{
            async getBook(){
                const res = await fetch(`/buyer/json/get-book-from-subgenre/${this.idSubgenre}`)
                if(res.ok)
                {
                    const buffer = await res.json()
                    this.listBook = buffer.bookList
                    this.namePage = buffer.namePage.name
                    console.log(this.listBook)
                }
            },
            getIdSubgenre(){
                this.idSubgenre = Number(new URL(location.href).searchParams.get('id')) 
            },
            async handlerBuy(item){
                location.href = 'http://localhost:9001/content/get-book/'+item.id           
            }
        },
        mounted(){
            this.getIdSubgenre()
            this.getBook()
        }
    })
    bodySub.component('subgenre-book',{
        props:['listBook','handlerBuy'],
        template:`
             <div class="row">
                 <div class="col-3">
                        <h3>
                            Автор
                        </h3>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                Default checkbox
                            </label>
                        </div>
                    </div>
               <div class="col">
                 <div class="row ">
                     <div class="d-flex flex-column col-2 mt-3"  v-for="item in listBook">
                        <img class="w-100"  height="280"  :src="'http://localhost:9001/get-image/'+item.id+'.jpg'">
                        <div v-if="item.discount!==null" class="fw-bold fs-4">
                        {{Math.floor(item.price-item.price*(item.discount/100))+"₽"}}<del class="mx-2">{{item.price+"₽"}}</del>
                        </div>
                        <div v-else class="fw-bold fs-4">
                        {{item.price+"₽"}}
                        </div>
                        <div class="fs-6">
                        {{item.name}}
                        </div>
                        <div class="fs-8 fw-light">
                        {{item.authorName +' ' +item.lastname}}
                        </div>
                        <button type="button" class="align-self-end mt-auto btn btn-primary w-100" @click="handlerBuy(item)">Купить</button>  
                    </div>

                </div>
              
            </div>
        </div>
        `
    })
    bodySub.mount('#bodySub')
</script>
<%-include("../partials/footer")%> 